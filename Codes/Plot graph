import os
import pandas as pd
import matplotlib.pyplot as plt
from openpyxl import Workbook
from openpyxl.drawing.image import Image

input_folder = 'Extracted Data/VRU Headform - Color-wise data'
output_folder = 'Extracted Data/VRU Headform - Color-wise graph'

# Ensure the output folder exists
os.makedirs(output_folder, exist_ok=True)

# Iterate through each file in the input folder
for filename in os.listdir(input_folder):
    if filename.endswith('.xlsx'):
        file_path = os.path.join(input_folder, filename)
        output_file = os.path.join(output_folder, filename)
        
        # Create a new workbook for the graphs
        wb = Workbook()
        ws = wb.active
        ws.title = "Graphs"

        # Read the Excel file
        xls = pd.ExcelFile(file_path)

        # Iterate through each sheet in the Excel file
        for sheet_name in xls.sheet_names:
            df = pd.read_excel(xls, sheet_name=sheet_name)
            
            # Plot the graph
            plt.figure(figsize=(10, 6))
            plt.bar(df['Car Name'], df['Value'])
            plt.title(sheet_name)
            plt.xlabel('Car Name')
            plt.ylabel('Value')

            # Save the plot to a temporary file
            temp_img_path = f'{sheet_name}.png'
            plt.savefig(temp_img_path)
            plt.close()

            # Add the plot image to the Excel sheet
            img = Image(temp_img_path)
            ws.add_image(img, f'A{ws.max_row + 2}')

            # Remove the temporary image file
            os.remove(temp_img_path)

        # Save the workbook with all graphs
        wb.save(output_file)

print("Graphs have been generated and saved successfully.")
