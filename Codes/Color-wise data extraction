import os
from openpyxl import load_workbook, Workbook

input_folder = 'Extracted Data/VRU Headform - Prediction tables'
output_folder = 'Extracted Data/VRU Headform - Color-wise data'

# Ensure output folder exists
os.makedirs(output_folder, exist_ok=True)

# Iterate through each Excel file in the input folder
for filename in os.listdir(input_folder):
    if filename.endswith('.xlsx'):
        # Load the input workbook
        input_path = os.path.join(input_folder, filename)
        input_wb = load_workbook(input_path)
        input_sheet = input_wb.active

        # Create a new workbook for output
        output_wb = Workbook()
        output_sheet = output_wb.active
        output_filename = os.path.join(output_folder, filename)
        
        # Get the sheet names to be created from the first sheet's second column
        sheet_names = [cell.value for cell in input_sheet['B'] if cell.value is not None]

        # Write headers in the output sheet
        headers = ['Car Name'] + sheet_names
        output_sheet.append(headers)

        # Create a dictionary to store values by car name
        car_values = {sheet_name: [] for sheet_name in sheet_names}

        for input_sheet_name in input_wb.sheetnames:
            input_sheet = input_wb[input_sheet_name]
            
            # Search for the sheet names in the input sheet
            for row in input_sheet.iter_rows(min_row=1, max_row=input_sheet.max_row, min_col=1, max_col=input_sheet.max_column):
                for cell in row:
                    if cell.value in sheet_names:
                        value = (row[4].value if len(row) > 4 else None) * 100
                        car_values[cell.value].append(value)
                        break
        
        # Write car data to the output sheet
        for car_name in sheet_names:
            row_data = [car_name] + car_values[car_name]
            output_sheet.append(row_data)

        # Save the output workbook
        output_wb.save(output_filename)
        print(f'Processed and saved: {output_filename}')
