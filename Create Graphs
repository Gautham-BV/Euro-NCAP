import pandas as pd
import os

# Define input and output folders
input_folder = 'Extracted Data/VRU Headform - Prediction tables'
output_folder = 'Extracted Data/VRU Headform - Color-wise graphs'

# Create output folder if it does not exist
os.makedirs(output_folder, exist_ok=True)

# Output Excel file path
output_file = os.path.join(output_folder, 'output.xlsx')

# Function to process each Excel file
def process_excel(file_path):
    excel_data = pd.ExcelFile(file_path)
    
    for sheet_name in excel_data.sheet_names:
        df = pd.read_excel(file_path, sheet_name=sheet_name)
        
        if df.shape[1] > 3:  # Ensure there are enough columns
            df['Picked Value'] = df.iloc[:, 1].shift(-3)  # Get value 3 places right of the cell
            df_result = df[['Picked Value']].dropna().reset_index(drop=True)
            
            # Append data to the output file
            with pd.ExcelWriter(output_file, engine='openpyxl', mode='a' if os.path.exists(output_file) else 'w') as writer:
                df_result.to_excel(writer, sheet_name=sheet_name, index=False)

# Process all Excel files in the input folder
for file_name in os.listdir(input_folder):
    if file_name.endswith('.xlsx'):
        file_path = os.path.join(input_folder, file_name)
        process_excel(file_path)

print(f'Processing complete. Results saved to {output_file}')
