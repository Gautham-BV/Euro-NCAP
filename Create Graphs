import pandas as pd
import os

# Define the input and output folders
input_folder = 'Extracted Data/VRU Headform - Prediction tables'
output_folder = 'Extracted Data/VRU Headform - Color-wise graphs'

# Ensure the output folder exists
os.makedirs(output_folder, exist_ok=True)

# List all Excel files in the input folder
excel_files = [f for f in os.listdir(input_folder) if f.endswith('.xlsx')]

for excel_file in excel_files:
    # Read the first sheet of the Excel file to get sheet names
    input_file_path = os.path.join(input_folder, excel_file)
    df = pd.read_excel(input_file_path, sheet_name=0)

    # Get the list of names from the second column of the first sheet
    sheet_names = df.iloc[:, 1].dropna().unique()

    # Create a new Excel writer for the output file
    output_file_path = os.path.join(output_folder, excel_file)
    with pd.ExcelWriter(output_file_path, engine='openpyxl') as writer:
        for sheet_name in sheet_names:
            # Create a new sheet in the output file
            sheet_data = []

            # Search for the sheet name in each sheet of the input file
            for sheet in pd.ExcelFile(input_file_path).sheet_names:
                sheet_df = pd.read_excel(input_file_path, sheet_name=sheet)
                
                # Check if the sheet_name exists in the current sheet's first column
                if sheet_name in sheet_df.iloc[:, 0].values:
                    value = sheet_df.loc[sheet_df.iloc[:, 0] == sheet_name].iloc[0, 1]
                    sheet_data.append([sheet, value])
            
            # Create a DataFrame from the collected data and write it to the sheet
            output_df = pd.DataFrame(sheet_data, columns=['Car Name', 'Values'])
            output_df.to_excel(writer, sheet_name=sheet_name, index=False)

print("Processing complete. Output files have been saved.")
